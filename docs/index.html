<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Code Examples for DBI and RPostgres</title>
  <meta name="description" content="Code Examples for DBI and RPostgres" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Code Examples for DBI and RPostgres" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="Shena4746/datascience-100knocks-preprocess-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Code Examples for DBI and RPostgres" />
  
  
  

<meta name="author" content="Shena" />


<meta name="date" content="2022-07-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #232629;
    color: #7a7c7d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
div.sourceCode
  { color: #cfcfc2; background-color: #232629; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #cfcfc2; } /* Normal */
code span.al { color: #95da4c; } /* Alert */
code span.an { color: #3f8058; } /* Annotation */
code span.at { color: #2980b9; } /* Attribute */
code span.bn { color: #f67400; } /* BaseN */
code span.bu { color: #7f8c8d; } /* BuiltIn */
code span.cf { color: #fdbc4b; } /* ControlFlow */
code span.ch { color: #3daee9; } /* Char */
code span.cn { color: #27aeae; } /* Constant */
code span.co { color: #7a7c7d; } /* Comment */
code span.cv { color: #7f8c8d; } /* CommentVar */
code span.do { color: #a43340; } /* Documentation */
code span.dt { color: #2980b9; } /* DataType */
code span.dv { color: #f67400; } /* DecVal */
code span.er { color: #da4453; } /* Error */
code span.ex { color: #0099ff; } /* Extension */
code span.fl { color: #f67400; } /* Float */
code span.fu { color: #8e44ad; } /* Function */
code span.im { color: #27ae60; } /* Import */
code span.in { color: #c45b00; } /* Information */
code span.kw { color: #cfcfc2; } /* Keyword */
code span.op { color: #cfcfc2; } /* Operator */
code span.ot { color: #27ae60; } /* Other */
code span.pp { color: #27ae60; } /* Preprocessor */
code span.re { color: #2980b9; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #da4453; } /* SpecialString */
code span.st { color: #f44f4f; } /* String */
code span.va { color: #27aeae; } /* Variable */
code span.vs { color: #da4453; } /* VerbatimString */
code span.wa { color: #da4453; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#libraries"><i class="fa fa-check"></i><b>1</b> Libraries</a></li>
<li class="chapter" data-level="2" data-path=""><a href="#connection"><i class="fa fa-check"></i><b>2</b> Connection</a></li>
<li class="chapter" data-level="3" data-path=""><a href="#functions-for-views"><i class="fa fa-check"></i><b>3</b> Functions for Views</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#create-a-view"><i class="fa fa-check"></i><b>3.1</b> Create a View</a><ul>
<li class="chapter" data-level="3.1.1" data-path=""><a href="#create-a-view-from-a-sql-select-statement"><i class="fa fa-check"></i><b>3.1.1</b> Create a View from a SQL <code>SELECT</code> Statement</a></li>
<li class="chapter" data-level="3.1.2" data-path=""><a href="#create-a-view-from-a-tbl_lazy"><i class="fa fa-check"></i><b>3.1.2</b> Create a View From a <code>tbl_lazy</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#list-views"><i class="fa fa-check"></i><b>3.2</b> List views</a><ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#definition-2"><i class="fa fa-check"></i><b>3.2.1</b> Definition</a></li>
<li class="chapter" data-level="3.2.2" data-path=""><a href="#example-2"><i class="fa fa-check"></i><b>3.2.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#test-existance-of-a-view"><i class="fa fa-check"></i><b>3.3</b> Test existance of a view</a><ul>
<li class="chapter" data-level="3.3.1" data-path=""><a href="#definition-3"><i class="fa fa-check"></i><b>3.3.1</b> Definition</a></li>
<li class="chapter" data-level="3.3.2" data-path=""><a href="#example-3"><i class="fa fa-check"></i><b>3.3.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#drop"><i class="fa fa-check"></i><b>3.4</b> Drop a view</a><ul>
<li class="chapter" data-level="3.4.1" data-path=""><a href="#definition-4"><i class="fa fa-check"></i><b>3.4.1</b> Definition</a></li>
<li class="chapter" data-level="3.4.2" data-path=""><a href="#example-4"><i class="fa fa-check"></i><b>3.4.2</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#misc"><i class="fa fa-check"></i><b>4</b> Misc</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#discard"><i class="fa fa-check"></i><b>4.1</b> Free resources</a><ul>
<li class="chapter" data-level="4.1.1" data-path=""><a href="#definition-5"><i class="fa fa-check"></i><b>4.1.1</b> Definition</a></li>
<li class="chapter" data-level="4.1.2" data-path=""><a href="#example-5"><i class="fa fa-check"></i><b>4.1.2</b> Example</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Code Examples for DBI and RPostgres</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Code Examples for DBI and RPostgres</h1>
<p class="author"><em>Shena</em></p>
<p class="date"><em>2022-07-07</em></p>
</div>
<div id="libraries" class="section level1 hasAnchor">
<h1><span class="header-section-number">1</span> Libraries<a href="#libraries" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">&quot;RPostgres&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(<span class="st">&quot;DBI&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(<span class="st">&quot;dbplyr&quot;</span>)</a></code></pre></div>
<p>This document is based on the following conditions.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">R.version.string</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">## [1] &quot;R version 4.2.0 (2022-04-22)&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">packageVersion</span>(<span class="st">&quot;RPostgres&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">## [1] &#39;1.4.4.9000&#39;</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">packageVersion</span>(<span class="st">&quot;DBI&quot;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">## [1] &#39;1.1.3&#39;</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">packageVersion</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">## [1] &#39;1.0.9&#39;</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">packageVersion</span>(<span class="st">&quot;dbplyr&quot;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">## [1] &#39;2.2.1&#39;</span></a></code></pre></div>
</div>
<div id="connection" class="section level1 hasAnchor">
<h1><span class="header-section-number">2</span> Connection<a href="#connection" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">issue_con &lt;-<span class="st"> </span><span class="cf">function</span>(service_name) {</a>
<a class="sourceLine" id="cb3-2" title="2">    dw &lt;-<span class="st"> </span>config<span class="op">::</span><span class="kw">get</span>(service_name)</a>
<a class="sourceLine" id="cb3-3" title="3">    con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb3-4" title="4">        <span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb3-5" title="5">        <span class="dt">host =</span> dw<span class="op">$</span>host,</a>
<a class="sourceLine" id="cb3-6" title="6">        <span class="dt">port =</span> dw<span class="op">$</span>port,</a>
<a class="sourceLine" id="cb3-7" title="7">        <span class="dt">dbname =</span> dw<span class="op">$</span>dbname,</a>
<a class="sourceLine" id="cb3-8" title="8">        <span class="dt">user =</span> dw<span class="op">$</span>user,</a>
<a class="sourceLine" id="cb3-9" title="9">        <span class="dt">password =</span> dw<span class="op">$</span>password</a>
<a class="sourceLine" id="cb3-10" title="10">    )</a>
<a class="sourceLine" id="cb3-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a></code></pre></div>


</div>
<div id="functions-for-views" class="section level1 hasAnchor">
<h1><span class="header-section-number">3</span> Functions for Views<a href="#functions-for-views" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>table example</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="cf">if</span> (con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExistsTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) {</a>
<a class="sourceLine" id="cb5-2" title="2">    con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>())</a>
<a class="sourceLine" id="cb5-3" title="3">}</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">##    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
<div id="create-a-view" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.1</span> Create a View<a href="#create-a-view" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="create-a-view-from-a-sql-select-statement" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.1</span> Create a View from a SQL <code>SELECT</code> Statement<a href="#create-a-view-from-a-sql-select-statement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Creates a view from the passed SQL query.</li>
<li>Returns <code>TRUE</code> invisibly.</li>
<li><code>temporary = FALSE</code> and <code>or_replace = FALSE</code> arguments specify whether to enable <code>TEMPORARY</code> and <code>OR REPLACE</code> options, respectively.</li>
</ul>
<div id="definition" class="section level4 hasAnchor">
<h4><span class="header-section-number">3.1.1.1</span> Definition<a href="#definition" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">dbCreateView &lt;-<span class="st"> </span><span class="cf">function</span>(con, sql_view, name, <span class="dt">or_replace =</span> <span class="ot">FALSE</span>, <span class="dt">temporary =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="cf">if</span> (sql_view <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inherits</span>(<span class="kw">c</span>(<span class="st">&quot;character&quot;</span>, <span class="st">&quot;SQL&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) <span class="kw">stop</span>(<span class="st">&quot;provided sql string is not of class character or SQL.&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">    sql &lt;-<span class="st"> &quot;CREATE ?or ?tmp VIEW ?name AS ?q&quot;</span></a>
<a class="sourceLine" id="cb6-4" title="4">    stm &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb6-5" title="5">        con,</a>
<a class="sourceLine" id="cb6-6" title="6">        sql,</a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="dt">or =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(or_replace, <span class="st">&quot;OR REPLACE&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb6-8" title="8">        <span class="dt">tmp =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(temporary, <span class="st">&quot;TEMPORARY&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb6-9" title="9">        <span class="dt">name =</span> name <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbQuoteIdentifier</span>(con, .),</a>
<a class="sourceLine" id="cb6-10" title="10">        <span class="dt">q =</span> sql_view <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb6-11" title="11">    )</a>
<a class="sourceLine" id="cb6-12" title="12">    DBI<span class="op">::</span><span class="kw">dbExecute</span>(con, stm)</a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="kw">invisible</span>(<span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">return</span>()</a>
<a class="sourceLine" id="cb6-14" title="14">}</a></code></pre></div>
<p>Since <code>DBI::dbExecute</code> does not accept multiple statements, <code>dbCreateView</code> is not subject to SQL injection of that form.</p>
</div>
<div id="example" class="section level4 hasAnchor">
<h4><span class="header-section-number">3.1.1.2</span> Example<a href="#example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Given a set of <code>SELECT</code> queries and names that should be complied as views, you can create those views at once.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">cyls &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb7-2" title="2">names &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(cyls, <span class="op">~</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;view_cyl=&quot;</span>, .x, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb7-3" title="3">sqls &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(cyls, <span class="op">~</span><span class="st"> </span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb7-4" title="4">    con,</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="st">&quot;SELECT * FROM mtcars WHERE cyl = ?cyl&quot;</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">cyl =</span> .x</a>
<a class="sourceLine" id="cb7-7" title="7">))</a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># vectorised view creation</span></a>
<a class="sourceLine" id="cb7-9" title="9">purrr<span class="op">::</span><span class="kw">map2_lgl</span>(sqls, names, <span class="op">~</span><span class="st"> </span><span class="kw">dbCreateView</span>(con, .x, .y))</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">## [1] TRUE TRUE TRUE</span></a>
<a class="sourceLine" id="cb7-11" title="11">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>()</a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">## [1] &quot;view_cyl=8&quot; &quot;view_cyl=6&quot; &quot;view_cyl=4&quot;</span></a></code></pre></div>
</div>
</div>
<div id="create-a-view-from-a-tbl_lazy" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.2</span> Create a View From a <code>tbl_lazy</code><a href="#create-a-view-from-a-tbl_lazy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Create a view from a <code>tbl_lazy</code> object that arises from typical dbplyr work.</li>
<li>Returns <code>TRUE</code> invisibly.</li>
<li>Accpepts the same arguments as <code>dbCreateView</code>.</li>
</ul>
<div id="definition-1" class="section level4 hasAnchor">
<h4><span class="header-section-number">3.1.2.1</span> Definition<a href="#definition-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">CreateView &lt;-<span class="st"> </span><span class="cf">function</span>(con, tbl, name, <span class="dt">or_replace =</span> <span class="ot">FALSE</span>, <span class="dt">temporary =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb8-2" title="2">    <span class="cf">if</span> (tbl <span class="op">%&gt;%</span><span class="st"> </span>base<span class="op">::</span><span class="kw">inherits</span>(<span class="st">&quot;tbl_lazy&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) <span class="kw">stop</span>(<span class="st">&quot;provided tbl is not of class tbl_lazy&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="st">&quot;CREATE ?or ?tmp VIEW ?name AS ?tbl_sql&quot;</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="st">        </span>DBI<span class="op">::</span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb8-5" title="5">            con,</a>
<a class="sourceLine" id="cb8-6" title="6">            .,</a>
<a class="sourceLine" id="cb8-7" title="7">            <span class="dt">or =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(or_replace, <span class="st">&quot;OR REPLACE&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb8-8" title="8">            <span class="dt">tmp =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(temporary, <span class="st">&quot;TEMPORARY&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb8-9" title="9">            <span class="dt">name =</span> name <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbQuoteIdentifier</span>(con, .),</a>
<a class="sourceLine" id="cb8-10" title="10">            <span class="dt">tbl_sql =</span> dbplyr<span class="op">::</span><span class="kw">sql_render</span>(tbl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb8-11" title="11">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="st">        </span>DBI<span class="op">::</span><span class="kw">dbExecute</span>(con, .)</a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="kw">invisible</span>(<span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">return</span>()</a>
<a class="sourceLine" id="cb8-14" title="14">}</a></code></pre></div>
</div>
<div id="example-1" class="section level4 hasAnchor">
<h4><span class="header-section-number">3.1.2.2</span> Example<a href="#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
</div>
<div id="list-views" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.2</span> List views<a href="#list-views" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Lists all view names, including tempoary ones.</li>
<li>Returns a vector of strings represeting view names.</li>
<li>The arguments <code>parmanent = TRUE</code> and <code>temporary = TRUE</code> specify whether to include non-temporal and tempoary views, respectively. <code>NULL</code> is returned if both are set to <code>FALSE</code>.</li>
</ul>
<div id="definition-2" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.2.1</span> Definition<a href="#definition-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">dbListViews &lt;-<span class="st"> </span><span class="cf">function</span>(con, <span class="dt">parmanent =</span> <span class="ot">TRUE</span>, <span class="dt">temporary =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb9-2" title="2">    <span class="cf">if</span> (<span class="kw">c</span>(parmanent, temporary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">all</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) {</a>
<a class="sourceLine" id="cb9-3" title="3">        <span class="ot">NULL</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">            </span><span class="kw">invisible</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">            </span><span class="kw">return</span>()</a>
<a class="sourceLine" id="cb9-6" title="6">    }</a>
<a class="sourceLine" id="cb9-7" title="7">    sql &lt;-<span class="st"> &quot;?p ?u ?t&quot;</span></a>
<a class="sourceLine" id="cb9-8" title="8">    parm &lt;-<span class="st"> &quot;SELECT pg_views.viewname AS viewname FROM pg_views WHERE schemaname = current_schema()&quot;</span></a>
<a class="sourceLine" id="cb9-9" title="9">    tmp &lt;-<span class="st"> &quot;SELECT viewname FROM pg_views WHERE schemaname LIKE &#39;pg_temp_%&#39;&quot;</span></a>
<a class="sourceLine" id="cb9-10" title="10">    <span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb9-11" title="11">        con,</a>
<a class="sourceLine" id="cb9-12" title="12">        sql,</a>
<a class="sourceLine" id="cb9-13" title="13">        <span class="dt">p =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(parmanent, parm, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb9-14" title="14">        <span class="dt">u =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(<span class="kw">c</span>(parmanent, temporary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">all</span>(), <span class="st">&quot;UNION&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb9-15" title="15">        <span class="dt">t =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(temporary, tmp, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb9-16" title="16">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="st">        </span><span class="kw">dbGetQuery</span>(con, .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="st">        </span><span class="kw">pull</span>(viewname)</a>
<a class="sourceLine" id="cb9-19" title="19">}</a></code></pre></div>
</div>
<div id="example-2" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.2.2</span> Example<a href="#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="test-existance-of-a-view" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.3</span> Test existance of a view<a href="#test-existance-of-a-view" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Test the existance of views.</li>
<li>Returns a logical vector of the same length as the input.</li>
<li>Accpepts the same arguments as <code>dbCreateView</code>.</li>
</ul>
<div id="definition-3" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.3.1</span> Definition<a href="#definition-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">dbExistsView &lt;-<span class="st"> </span><span class="cf">function</span>(con, name, <span class="dt">parmanent =</span> <span class="ot">TRUE</span>, <span class="dt">temporary =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb10-2" title="2">    name <span class="op">%in%</span><span class="st"> </span><span class="kw">dbListViews</span>(con, parmanent, temporary)</a>
<a class="sourceLine" id="cb10-3" title="3">}</a></code></pre></div>
</div>
<div id="example-3" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.3.2</span> Example<a href="#example-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="drop" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.4</span> Drop a view<a href="#drop" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Drops a view.</li>
<li>Returns the total number of views dropped, invisibly.</li>
<li>The arguments <code>if_exists = FALSE</code> and <code>cascade = FALSE</code> specify whether to enable the corresponding SQL options. If <code>cascade = FALSE</code>, the default, then <code>RESTRICT</code> option is set.</li>
</ul>
<div id="definition-4" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.1</span> Definition<a href="#definition-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">dbDropView &lt;-<span class="st"> </span><span class="cf">function</span>(con, name, <span class="dt">if_exists =</span> <span class="ot">FALSE</span>, <span class="dt">cascade =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) <span class="kw">stop</span>(<span class="st">&quot;dplyr library is required.&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" title="3">    before &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="st">        </span><span class="kw">dbListViews</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="st">        </span><span class="kw">length</span>()</a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="st">&quot;DROP VIEW ?if_ex ?name ?cas_res&quot;</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="st">        </span>DBI<span class="op">::</span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb11-8" title="8">            con,</a>
<a class="sourceLine" id="cb11-9" title="9">            .,</a>
<a class="sourceLine" id="cb11-10" title="10">            <span class="dt">if_ex =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(if_exists, <span class="st">&quot;IF EXISTS&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>(),</a>
<a class="sourceLine" id="cb11-11" title="11">            <span class="dt">name =</span> name <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbQuoteIdentifier</span>(con, .),</a>
<a class="sourceLine" id="cb11-12" title="12">            <span class="dt">cas_res =</span> dplyr<span class="op">::</span><span class="kw">if_else</span>(cascade, <span class="st">&quot;CASCADE&quot;</span>, <span class="st">&quot;RESTRICT&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb11-13" title="13">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="st">        </span>DBI<span class="op">::</span><span class="kw">dbExecute</span>(con, .)</a>
<a class="sourceLine" id="cb11-15" title="15">    before <span class="op">-</span><span class="st"> </span>(con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()</a>
<a class="sourceLine" id="cb11-16" title="16">}</a></code></pre></div>
</div>
<div id="example-4" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.2</span> Example<a href="#example-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>View can be dropped in a vectorised way. If you are dropping temprary views only, then you can use the <code>DISCARD</code> statement <a href="#discard">4.1</a>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># create views to demonstrate a vectorised removal</span></a>
<a class="sourceLine" id="cb12-2" title="2">sql &lt;-<span class="st"> &quot;SELECT * FROM mtcars LIMIT 10&quot;</span></a>
<a class="sourceLine" id="cb12-3" title="3">names &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;view&quot;</span>, .x, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb12-4" title="4">tmps &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span><span class="st"> </span>.x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">purrr<span class="op">::</span><span class="kw">map2_lgl</span>(names, tmps, <span class="op">~</span><span class="st"> </span><span class="kw">dbCreateView</span>(con, sql, .x, <span class="dt">temporary =</span> .y)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>() <span class="co"># discard output</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>()</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">## [1] &quot;view1&quot; &quot;view2&quot; &quot;view4&quot; &quot;view3&quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9"></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co"># drop only temporary views</span></a>
<a class="sourceLine" id="cb12-11" title="11">con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="st">    </span><span class="kw">dbListViews</span>(<span class="dt">temporary =</span> <span class="ot">TRUE</span>, <span class="dt">parmanent =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">dbDropView</span>(con, .x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="st">    </span><span class="kw">sum</span>() <span class="co"># total number of tables dropped</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">## [1] 2</span></a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>() <span class="co"># non-temporary views are still alive</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">## [1] &quot;view4&quot; &quot;view3&quot;</span></a>
<a class="sourceLine" id="cb12-19" title="19"></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co"># drop them</span></a>
<a class="sourceLine" id="cb12-21" title="21">con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-22" title="22"><span class="st">    </span><span class="kw">dbListViews</span>(<span class="dt">temporary =</span> <span class="ot">FALSE</span>, <span class="dt">parmanent =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">dbDropView</span>(con, .x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="st">    </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">## [1] 2</span></a>
<a class="sourceLine" id="cb12-26" title="26"></a>
<a class="sourceLine" id="cb12-27" title="27">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>()</a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co">## character(0)</span></a></code></pre></div>
<p>Dependent views could be a source of an error during this vectorised removal. Set <code>if_exists = TRUE</code> whenever <code>cascade = TRUE</code> to omit this problem.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbCreateView</span>(</a>
<a class="sourceLine" id="cb13-2" title="2">    <span class="dt">sql =</span> <span class="st">&quot;SELECT * FROM mtcars LIMIT 10&quot;</span>,</a>
<a class="sourceLine" id="cb13-3" title="3">    <span class="dt">name =</span> <span class="st">&quot;view_super&quot;</span></a>
<a class="sourceLine" id="cb13-4" title="4">)</a>
<a class="sourceLine" id="cb13-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbCreateView</span>(</a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="dt">sql =</span> <span class="st">&quot;SELECT * FROM view_super LIMIT 10&quot;</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="dt">name =</span> <span class="st">&quot;view_sub&quot;</span></a>
<a class="sourceLine" id="cb13-8" title="8">)</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co"># set `if_exists = TRUE` to skip an cascade-dropped view</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="kw">c</span>(<span class="st">&quot;view_super&quot;</span>, <span class="st">&quot;view_sub&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">dbDropView</span>(con, .x, <span class="dt">cascade =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">## </span><span class="al">NOTICE</span><span class="co">:  drop cascades to view view_sub</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">## Error: Failed to fetch row: ERROR:  view &quot;view_sub&quot; does not exist</span></a></code></pre></div>


</div>
</div>
</div>
<div id="misc" class="section level1 hasAnchor">
<h1><span class="header-section-number">4</span> Misc<a href="#misc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="discard" class="section level2 hasAnchor">
<h2><span class="header-section-number">4.1</span> Free resources<a href="#discard" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Executes a <code>DISCARD</code> SQL statement.</li>
<li>Returns <code>TRUE</code> invisibly even if it does nothing.</li>
<li>The arguments <code>all = FALSE</code>, <code>plans = TRUE</code> and <code>temporary = TRUE</code> specify which of the corresponding SQL statement option should be applied. If multiple options are selected, only the most dominant one will be executed. If none is selected, nothing will be done.</li>
</ul>
<div id="definition-5" class="section level3 hasAnchor">
<h3><span class="header-section-number">4.1.1</span> Definition<a href="#definition-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">dbDiscard &lt;-<span class="st"> </span><span class="cf">function</span>(con, <span class="dt">all =</span> <span class="ot">FALSE</span>, <span class="dt">plans =</span> <span class="ot">FALSE</span>, <span class="dt">temporary =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb14-2" title="2">    <span class="cf">if</span> (<span class="kw">c</span>(all, plans, temporary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">any</span>()) {</a>
<a class="sourceLine" id="cb14-3" title="3">        resource &lt;-<span class="st"> </span><span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb14-4" title="4">            all <span class="op">~</span><span class="st"> &quot;ALL&quot;</span>,</a>
<a class="sourceLine" id="cb14-5" title="5">            plans <span class="op">~</span><span class="st"> &quot;PLANS&quot;</span>,</a>
<a class="sourceLine" id="cb14-6" title="6">            temporary <span class="op">~</span><span class="st"> &quot;TEMPORARY&quot;</span></a>
<a class="sourceLine" id="cb14-7" title="7">        )</a>
<a class="sourceLine" id="cb14-8" title="8">        <span class="st">&quot;DISCARD ?rsc&quot;</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="st">            </span>DBI<span class="op">::</span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb14-10" title="10">                con,</a>
<a class="sourceLine" id="cb14-11" title="11">                .,</a>
<a class="sourceLine" id="cb14-12" title="12">                <span class="dt">rsc =</span> resource <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb14-13" title="13">            ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="st">            </span>DBI<span class="op">::</span><span class="kw">dbExecute</span>(con, .)</a>
<a class="sourceLine" id="cb14-15" title="15">    }</a>
<a class="sourceLine" id="cb14-16" title="16">    <span class="kw">invisible</span>(<span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">return</span>()</a>
<a class="sourceLine" id="cb14-17" title="17">}</a></code></pre></div>
</div>
<div id="example-5" class="section level3 hasAnchor">
<h3><span class="header-section-number">4.1.2</span> Example<a href="#example-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>DISCARD TEMPORARY</code> removes tempoary views at once, intead of listing and dropping them, as we did in <a href="#drop">3.4</a>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># prepare temporary and non-temporary views</span></a>
<a class="sourceLine" id="cb15-2" title="2">sql &lt;-<span class="st"> &quot;SELECT * FROM mtcars LIMIT 10&quot;</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb15-4" title="4">    <span class="kw">dbCreateView</span>(con, sql, <span class="kw">paste</span>(<span class="st">&quot;view&quot;</span>, i, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="dt">temporary =</span> <span class="kw">isTRUE</span>(i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb15-5" title="5">}</a>
<a class="sourceLine" id="cb15-6" title="6"></a>
<a class="sourceLine" id="cb15-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>()</a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">## [1] &quot;view1&quot; &quot;view2&quot; &quot;view4&quot; &quot;view3&quot;</span></a>
<a class="sourceLine" id="cb15-9" title="9">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDiscard</span>(<span class="dt">temporary =</span> <span class="ot">TRUE</span>) <span class="co"># delte all temporary objects</span></a>
<a class="sourceLine" id="cb15-10" title="10">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListViews</span>() <span class="co"># non-temporary views are stil alive</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">## [1] &quot;view4&quot; &quot;view3&quot;</span></a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
